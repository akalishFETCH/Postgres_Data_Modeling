# Postgres_Data_Modeling

## Introduction
A startup called Sparkify wants to analyze the data they've been collecting on songs and user activity on their new music streaming app. The analytics team is particularly interested in understanding what songs users are listening to. Currently, they don't have an easy way to query their data, which resides in a directory of JSON logs on user activity on the app, as well as a directory with JSON metadata on the songs in their app.

## Song Dataset
The first dataset is a subset of real data from the Million Song Dataset. Each file is in JSON format and contains metadata about a song and the artist of that song. The files are partitioned by the first three letters of each song's track ID. For example, here are filepaths to two files in this dataset.

### Song JSON columns: 
  - 'num_songs' 
  - 'artist_id' 
  - 'artist_latitude' 
  - 'artist_longitude' 
  - 'artist_location' 
  - 'artist_name' 
  - 'song_id' 
  - 'title' 
  - 'duration' 
  - 'year'

## Log Dataset
The second dataset consists of log files in JSON format generated by this event simulator based on the songs in the dataset above. These simulate activity logs from a music streaming app based on specified configurations.

### Log JSON columns: 
  - 'artist' 
  - 'auth' 
  - 'firstName' 
  - 'gender' 
  - 'itemInSession' 
  - 'lastName' 
  - 'length'
  - 'level' 
  - 'location' 
  - 'method' 
  - 'page' 
  - 'registration' 
  - 'sessionId' 
  - 'song' 
  - 'status' 
  - 'ts' 
  - 'userAgent' 
  - 'userId'
                    

## Assets:
Create a star schema optimized for song play analysis. The star schema contains 1 Fact Table and 4 Dimension Tables:

## Fact Table:
    -songplays - records in log data associated with song plays i.e. records with page NextSong
    -songplay_id, start_time, user_id, level, song_id, artist_id, session_id, location, user_agent

## Dimension Tables:
    -users - users in the app
    - user_id, 
    - first_name, 
    - last_name, 
    - gender, 
    - level
    
  ### songs - songs in music database
    - song_id, 
    - title, 
     -artist_id, 
     - year, 
     - duration
    
  ### artists - artists in music database
    - artist_id, 
    - name, 
    - location, 
    - latitude, 
    - longitude
    
  ### time - timestamps of records in songplays broken down into specific units
    - start_time, 
    - hour, 
    - day, 
    - week, 
    - month, 
    - year, 
    - weekday

## Python Files:
  ### sql_queries.py:
  - 5 DROP TABLE Queries - Drops the fact table and four dimension tables if they exist
  - 5 CREATE TABLE Queries - Creates the fact table and four dimension tables and assigns column names and variable type to each column
  - 5 TABLE INSERT Queries - Creates placeholders for data to be inserted into the fact table and four dimension tables
  - 1 SELECT Query - Extracts song_id and artist_id from songs and artist tables with placeholders to filter by song title, artist name
  - 1 OBJECT to store all drop table queries
  - 1 OBJECT to store all create table queries
  
### create_tables.py:
  - 3 Functions and MAIN (main executes all other)
  #### create_database function:
    - Creates a connection to the default database and a cursor to read/write to the database
    - DROP DATABASE Query - DROPS sparkifydb if exists
    - CREATE DATABASE Query - CREATES sparkifydb
    - Creates a connection to sparkifydb databse and a cursor to read/write to the database
  #### drop_tables function:
    - Calls DROP TABLE OBJECT from sql_queries to drop all relevant tables from sparkifydb
  #### create_tables function:
    - Calls CREATE TABLE OBJECT from sql_queries to create all relevant tables from sparkifydb
  
### etl.py:
    - 3 Functions and MAIN (main executes all other)
   #### process_song_file function:
        - Reads song file JSON into Pandas DB
        - Filters DB to song data and inserts into song DB using TABLE INSERT
        - Filters DB to song data and inserts into artist DB using TABLE INSERT
    - process_log_file function:
        - Reads log file JSON into Pandas DB
        - Filter to actions "NEXT SONG" only
        - Convert timestamp to datetime
        - Creates a time DataFrame and inserts into time DB using TABLE INSERT
        - Creates a user DataFrame and inserts into user DB using TABLE INSERT
        - Creates a songplay DataFrame and inserts into using DB using TABLE INSERT
     - process_data function:
        - Loop through folders to get all files in selected directory
        - iterate over files and use process log/song file function to move data to relevant table
